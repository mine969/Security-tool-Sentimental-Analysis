<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SOC Threat Dashboard</title>
    <style>
      :root {
        --bg-color: #0a0a0a;
        --card-bg: #111111;
        --text-color: #e0e0e0;
        --accent-green: #00ff41;
        --accent-red: #ff003c;
        --accent-blue: #00f3ff;
        --font-mono: "Courier New", Courier, monospace;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100vh;
        overflow: hidden;
      }

      h1 {
        color: var(--accent-blue);
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 30px;
        text-shadow: 0 0 10px var(--accent-blue);
      }

      .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        width: 100%;
        max-width: 1200px;
        height: 80%;
      }

      .card {
        background-color: var(--card-bg);
        border: 1px solid #333;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        display: flex;
        flex-direction: column;
      }

      .card-header {
        font-family: var(--font-mono);
        color: var(--accent-green);
        border-bottom: 1px solid #333;
        padding-bottom: 10px;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      /* Live Feed Styles */
      #log-container {
        flex-grow: 1;
        overflow-y: auto;
        font-family: var(--font-mono);
        font-size: 0.9rem;
      }

      .log-entry {
        margin-bottom: 8px;
        padding: 5px;
        border-left: 3px solid transparent;
        animation: fadeIn 0.3s ease;
      }

      .log-entry.Phishing {
        border-color: var(--accent-blue);
        color: #aaddff;
      }
      .log-entry.Ransomware {
        border-color: var(--accent-red);
        color: #ffaaaa;
      }
      .log-entry.DDoS {
        border-color: orange;
        color: #ffddaa;
      }
      .log-entry.Malware {
        border-color: yellow;
        color: #ffffaa;
      }

      /* Manual Scanner Styles */
      textarea {
        width: 100%;
        height: 100px;
        background-color: #000;
        border: 1px solid #333;
        color: var(--accent-green);
        font-family: var(--font-mono);
        padding: 10px;
        resize: none;
        margin-bottom: 10px;
      }

      button {
        background-color: var(--accent-blue);
        color: #000;
        border: none;
        padding: 10px 20px;
        font-weight: bold;
        cursor: pointer;
        text-transform: uppercase;
        transition: all 0.2s;
      }

      button:hover {
        background-color: #fff;
        box-shadow: 0 0 15px var(--accent-blue);
      }

      #result-display {
        margin-top: 20px;
        font-size: 1.5rem;
        font-weight: bold;
        text-align: center;
        min-height: 40px;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateX(-10px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #000;
      }
      ::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>SOC Threat Intelligence Dashboard</h1>

    <div class="container">
      <!-- Left Panel: Live Feed -->
      <div class="card">
        <div class="card-header">>> LIVE THREAT FEED</div>
        <div id="log-container">
          <!-- Logs will appear here -->
        </div>
      </div>

      <!-- Right Panel: Manual Scanner -->
      <div class="card">
        <div class="card-header">>> MANUAL THREAT SCANNER</div>
        <p style="color: #888; font-size: 0.9rem">
          Enter suspicious text log or email content below:
        </p>
        <textarea
          id="manual-input"
          placeholder="e.g., User received email with suspicious attachment..."
        ></textarea>
        <button onclick="scanText()">Analyze Threat</button>

        <div id="result-display"></div>

        <div
          style="
            margin-top: auto;
            border-top: 1px solid #333;
            padding-top: 20px;
          "
        >
          <div class="card-header">>> SYSTEM STATUS</div>
          <div
            style="
              display: flex;
              justify-content: space-between;
              font-family: var(--font-mono);
            "
          >
            <span>MODEL STATUS:</span>
            <span style="color: var(--accent-green)">ONLINE</span>
          </div>
          <div
            style="
              display: flex;
              justify-content: space-between;
              font-family: var(--font-mono);
              margin-top: 10px;
            "
          >
            <span>ACCURACY:</span>
            <span style="color: var(--accent-green)">100%</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Manual Scan Function
      async function scanText() {
        const text = document.getElementById("manual-input").value;
        const resultDisplay = document.getElementById("result-display");

        if (!text) return;

        resultDisplay.innerHTML =
          '<span style="color: #888;">Scanning...</span>';

        const response = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text: text }),
        });

        const data = await response.json();
        const prediction = data.prediction;

        let color = "#fff";
        if (prediction === "Ransomware") color = "var(--accent-red)";
        if (prediction === "Phishing") color = "var(--accent-blue)";
        if (prediction === "DDoS") color = "orange";
        if (prediction === "Malware") color = "yellow";

        resultDisplay.innerHTML = `<span style="color: ${color}; text-shadow: 0 0 10px ${color};">DETECTED: ${prediction.toUpperCase()}</span>`;
      }

      // Simulate Live Feed
      const mockLogs = [
        "Suspicious email received from unknown sender asking for password reset.",
        "High network traffic detected from multiple IPs targeting port 80.",
        "User reported files are encrypted and cannot be opened.",
        "Trojan detected in downloaded file attachment.",
        "SQL injection attempt on login page.",
        "Phishing link clicked by employee in finance department.",
        "Server CPU usage spiked to 100% due to incoming requests.",
        "Ransom note found on desktop demanding bitcoin payment.",
      ];

      async function addLog() {
        const logContainer = document.getElementById("log-container");
        const randomLog = mockLogs[Math.floor(Math.random() * mockLogs.length)];

        // Get prediction for this log
        const response = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text: randomLog }),
        });
        const data = await response.json();

        const entry = document.createElement("div");
        entry.className = `log-entry ${data.prediction}`;

        const time = new Date().toLocaleTimeString();
        entry.innerHTML = `<span style="color: #666;">[${time}]</span> ${randomLog} <span style="float:right; font-weight:bold;">${data.prediction}</span>`;

        logContainer.prepend(entry);

        // Keep only last 20 logs
        if (logContainer.children.length > 20) {
          logContainer.removeChild(logContainer.lastChild);
        }
      }

      // Start simulation loop
      setInterval(addLog, 2500);
    </script>
  </body>
</html>
